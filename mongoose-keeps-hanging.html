
<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<title>How to test React components using Karma and webpack – Nicolas Gallagher</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<meta property="og:title" content="How to test React components using Karma and webpack – Nicolas Gallagher" />
<meta property="og:description" content="One way to combine these popular tools to support unit testing">
<meta property="og:image" content="http://www.gravatar.com/avatar/9eecfabc23fd999927fa7989a7eaff5f.png?v=2&amp;s=300" />
<meta property="twitter:account_id" content="24974216">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@necolas">
<meta name="twitter:creator" content="@necolas">


<!--[if IE 8]><script src="/html5.d401792972cc77413e83a6fe2f94fee3.js"></script><![endif]-->
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:400,700">
<link rel="stylesheet" href="/MyStyle.css">

<header class="Header" role="banner">
  <div class="Container">
    <div class="Header-logo">
      <a href="/">
        <img src="http://www.gravatar.com/avatar/9eecfabc23fd999927fa7989a7eaff5f.png?v=2&amp;s=50" width="50" height="50" alt="">
        <span class="Header-prompt">Read more posts</span>
      </a>
    </div>
    
  </div>
</header>


<div class="Content" role="main">
  

<style>
  .Article-coverImage {
    
    
    
  }
</style>

<article class="Article">
  <div class="Container">
    <header class="Article-header">
      <div class="Article-data">
        <time class="Article-timestamp Timestamp" datetime="2015-05-17">May 17, 2015</time>
      </div>
      <h1 class="Article-title">How to test React components using Karma and webpack</h1>
      
      <div class="HzLine"></div>
      
    </header>
  </div>

  

  <div class="Container">
    <div class="Article-body">
      <p>I’m working on a project at Twitter that uses React and webpack. After a few
conversations with <a href="https://github.com/sokra">@sokra</a> last year, this is the
setup I put in place for testing React components (authored using JSX and ES6)
using Karma.</p>
<h2 id="dependencies">Dependencies</h2>
<p>You’ll need to install various packages. It looks like a lot of dependencies,
but all the non-Karma packages will be necessary for general module bundling
during development.</p>
<p>Full set of required packages:</p>
<ul>
<li><a href="https://www.npmjs.com/package/babel">babel-core</a>: to transform JSX and transpile ES6.</li>
<li><a href="https://www.npmjs.com/package/babel-loader">babel-loader</a>: webpack loader for Babel.</li>
<li><a href="https://www.npmjs.com/package/karma">karma</a>: the test runner.</li>
<li><a href="https://www.npmjs.com/package/karma-chai-plugins">karma-chai-plugins</a>: assertion library (or your library of choice).</li>
<li><a href="https://www.npmjs.com/package/karma-chrome-launcher">karma-chrome-launcher</a>: Chrome browser launcher.</li>
<li><a href="https://www.npmjs.com/package/karma-cli">karma-cli</a>: CLI tool for Karma.</li>
<li><a href="https://www.npmjs.com/package/karma-mocha">karma-mocha</a>: adapter for the Mocha testing framework.</li>
<li><a href="https://www.npmjs.com/package/karma-sourcemap-loader">karma-sourcemap-loader</a>: sourcemap loader.</li>
<li><a href="https://www.npmjs.com/package/karma-webpack">karma-webpack</a>: to use webpack with Karma.</li>
<li><a href="https://www.npmjs.com/package/react">react</a></li>
<li><a href="https://www.npmjs.com/package/webpack">webpack</a>: module bundler</li>
</ul>
<h2 id="webpack-entry-file">webpack entry file</h2>
<p>If you use webpack-specific features in your modules (e.g., loaders, plugins)
you will need to use webpack to build a test bundle. The fastest and simplest
approach is to create a single, test-specific entry file.</p>
<p>Create a file named <code>tests.bundle.js</code>. Within this file, you create a webpack
<a href="https://github.com/webpack/docs/wiki/context">context</a> to match all the
files that conform to a naming pattern – in this case <code>*.spec.js(x)</code>.</p>
<pre><code class="lang-js">var context = require.context(&#39;.&#39;, true, /.+\.spec\.jsx?$/);
context.keys().forEach(context);
module.exports = context;</code></pre>
<p>Next, you point Karma to this file.</p>
<h2 id="karma-config">Karma config</h2>
<p>Karma is configured using a <code>karma.conf.js</code> file. The browsers, plugins, and
frameworks are specified in the standard way.</p>
<p>Point Karma at the <code>tests.bundle.js</code> file, and run it through the relevant
preprocessor plugins (see example below).</p>
<p>The <code>karma-webpack</code> plugin relies on 2 custom properties of the Karma config:
<code>webpack</code> and <code>webpackMiddleware</code>. The value of the former must be a webpack
config object.</p>
<pre><code class="lang-js">module.exports = function (config) {
  config.set({
    browsers: [ &#39;Chrome&#39; ],
    // karma only needs to know about the test bundle
    files: [
      &#39;tests.bundle.js&#39;
    ],
    frameworks: [ &#39;chai&#39;, &#39;mocha&#39; ],
    plugins: [
      &#39;karma-chrome-launcher&#39;,
      &#39;karma-chai&#39;,
      &#39;karma-mocha&#39;,
      &#39;karma-sourcemap-loader&#39;,
      &#39;karma-webpack&#39;,
    ],
    // run the bundle through the webpack and sourcemap plugins
    preprocessors: {
      &#39;tests.bundle.js&#39;: [ &#39;webpack&#39;, &#39;sourcemap&#39; ]
    },
    reporters: [ &#39;dots&#39; ],
    singleRun: true,
    // webpack config object
    webpack: {
      devtool: &#39;inline-source-map&#39;,
      module: {
        loaders: [
          {
            exclude: /node_modules/,
            loader: &#39;babel-loader,
            test: /\.jsx?$/
          }
        ],
      }
    },
    webpackMiddleware: {
      noInfo: true,
    }
  });
};</code></pre>
<p>Rather than duplicating your webpack config, you can <code>require</code> it in the Karma
config file and override the <code>devtool</code> value to get sourcemaps working.</p>
<pre><code class="lang-js">var webpackConfig = require(&#39;./webpack.config&#39;);
webpackConfig.devtool = &#39;inline-source-map&#39;;

module.exports = function (config) {
  config.set({
    ...
    webpack: webpackConfig
  });
};</code></pre>
<p>That’s all you need to do to configure Karma to use webpack to load your JSX,
ES6 React components.</p>

    </div>
    <div class="Article-interactions">
      
      <a class="Article-action" title="Reply on Twitter" href="https://twitter.com/intent/tweet?in_reply_to=600357785503539200">
        <span class="Icon Icon--reply"></span><span class="u-isHiddenVisually">Reply on Twitter</span>
      </a>
      <a class="Article-action" title="Retweet on Twitter" href="https://twitter.com/intent/retweet?tweet_id=600357785503539200">
        <span class="Icon Icon--retweet"></span><span class="u-isHiddenVisually">Retweet on Twitter</span>
      </a>
      <a class="Article-action" title="Favorite on Twitter" href="https://twitter.com/intent/favorite?tweet_id=600357785503539200">
        <span class="Icon Icon--favorite"></span><span class="u-isHiddenVisually">Favorite on Twitter</span>
      </a>
      
      <div class="Article-tweet">
        
<a class="twitter-share-button"
   rel="external nofollow"
   title="Share this on Twitter"
   href="http://twitter.com/share?text=How to test React components using Karma and webpack&amp;url=http%3A%2F%2Fnicolasgallagher.com%2Fhow-to-test-react-components-karma-webpack%2F&amp;counturl=http%3A%2F%2Fnicolasgallagher.com%2Fhow-to-test-react-components-karma-webpack%2F&amp;via=necolas&amp;count=none&amp;size=medium"
   target="_blank">Tweet</a>

      </div>
    </div>
  </div>

  

</article>


</div>

<footer class="Footer" role="contentinfo">
  <div class="Container">
    <div class="HzLine"></div>
    <a class="twitter-follow-button" href="//twitter.com/necolas" data-show-count="false" data-lang="en" data-size="large">Follow @necolas</a>
    <p class="Footer-links">
      <a href="/about/">About</a>
      &middot;
      <a href="//twitter.com/necolas">Twitter</a>
      <a href="//vine.co/necolas">Vine</a>
      <a href="//github.com/necolas">GitHub</a>
    </p>
    <small class="Footer-legal">Copyright &#169; Tal Avissar.</small>
  </div>
</footer>

